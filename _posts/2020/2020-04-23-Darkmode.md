---
title: é€šè¿‡ JavaScript ç»™ç½‘ç«™åˆ‡æ¢å¤œé—´æ¨¡å¼
date: "2020-04-23 15:00:00"
update: "2021-06-26 16:53:00"
tags: [JavaScript, CSS, HTML]
category: blog
---

æœ€è¿‘çªå‘å¥‡æƒ³æƒ³ç»™åšå®¢åšä¸ªå¤œé—´æ¨¡å¼ã€‚

ç½‘ç»œä¸Šæœ‰å¾ˆå¤šå‚»ç“œåŒ–æ–¹æ³•ï¼Œæ¯”å¦‚ darkmode.jsï¼Œä½†æ˜¯ä»–çš„é»˜è®¤æ ·å¼åœ¨æˆ‘çš„åšå®¢ç½‘ç«™ä¸Šå®åœ¨æ˜¯éå¸¸ç³Ÿç³•ï¼Œå¹¶ä¸”å¹¶ä¸èƒ½å¾ˆæ–¹ä¾¿çš„æ›´æ”¹æ ·å¼ã€‚
<!-- more -->

è¿˜æœ‰å…¶ä»–æ–¹æ³•æ¯”å¦‚ç»™ `<body>` æ·»åŠ  `class` å†ç”¨ css é€‰æ‹©å™¨å®ç°æ ·å¼çš„æ›´æ¢ã€‚

æˆ‘æ³¨æ„åˆ°äº† HTML5 å¢åŠ äº†åª’ä½“æŸ¥è¯¢å’Œåª’ä½“ç›‘å¬å™¨ï¼Œä»¥åŠé€šè¿‡ alternate å±æ€§å€¼æ¥æ§åˆ¶ css æ˜¾ç¤º/éšè—çš„æ–¹æ³•ï¼Œäºæ˜¯å°±æœ‰äº†ä¸‹é¢è¿™ä¸ªç®€å•çš„å¤œé—´ä¸»é¢˜æ§åˆ¶å™¨ã€‚

åªéœ€è¦ 2 æ­¥å³å¯ã€‚

1. æ·»åŠ ä»¥ä¸‹å†…å®¹åˆ°ä½ çš„ç½‘é¡µä¸Šçš„ `<head>` å…ƒç´ ï¼Œdarkmode.css æ˜¯ç”¨äºå®ç°å¤œé—´æ¨¡å¼çš„å¤–éƒ¨cssæ–‡ä»¶ï¼Œæ³¨æ„å¼•å…¥é¡ºåºå¸¦æ¥çš„ä¼˜å…ˆçº§é—®é¢˜ã€‚

    ```html

    <!-- Darkmode Copyright 2021 YexuanXiao under MIT license -->
    <link rel="alternate stylesheet preload" as="style" href="darkmode.css" id="darkmode-css">
    <script>
    	// init darkmode
    	{
    		const darkmodeCss = document.getElementById('darkmode-css')
    		const media = matchMedia('(prefers-color-scheme: dark)')
    		const time = new Date().getHours()
    		if (media.matches || ((time > 20 || time < 6) && sessionStorage.getItem('darktheme') !== 'false')) {
    			darkmodeCss.rel = 'stylesheet'
    			sessionStorage.setItem('darktheme', 'true')
    		} else if (sessionStorage.getItem('darktheme') === 'true') {
    			darkmodeCss.rel = 'stylesheet'
    		} else {
    			sessionStorage.setItem('darktheme', 'false')
    		}
    		media.addEventListener('change', () => {
    			media.matches ? darkmodeCss.rel = 'stylesheet' : darkmodeCss.rel = 'alternate stylesheet'
    		})
    	}
    </script>

    ```

    æˆ‘å»ºè®®ä½ å°†å®ƒæ·»åŠ åˆ° `<head>` é‡Œçš„åŸå› æ˜¯è¿™æ ·å¯ä»¥è®©ä¸»é¢˜åˆ‡æ¢è¿…é€Ÿï¼Œåšåˆ°è®¿é—®é¡µé¢å°±å¯ä»¥ç›´æ¥æ˜¾ç¤ºå¤œé—´ä¸»é¢˜
ï¼Œè€Œä¸ä¼šå› ä¸º css æ¸²æŸ“é¡ºåºçš„é—®é¢˜å¯¼è‡´å‡ºç°å¤šä½™çš„é¢œè‰²çš„ç”»é¢ã€‚

    è¿™éƒ¨åˆ†å°±å¯ä»¥å®ç°æŒ‰æ—¶é—´å’Œæµè§ˆå™¨è¡Œä¸ºè‡ªåŠ¨åˆ‡æ¢å¤œé—´ä¸»é¢˜ï¼Œå¹¶ä¸”ä¼šæŸ¥è¯¢ cookie ä¸­çš„ themeï¼Œé€šè¿‡å€¼æ¥è‡ªåŠ¨åˆ‡æ¢ã€‚

2. å¼•å…¥æˆ–è€…æ·»åŠ  darkmode.jsï¼Œå†…å®¹ä¸º

    ```javascript

    // Darkmode Copyright 2021 YexuanXiao under MIT license
    // darkmode method
    function changeTheme() {
        const darkmodeCss = document.getElementById('darkmode-css');
        if (sessionStorage.getItem('darktheme') !== 'true') {
            darkmodeCss.rel = 'stylesheet'
            sessionStorage.setItem('darktheme', 'true')
        } else {
            darkmodeCss.rel = 'alternate stylesheet'
            sessionStorage.setItem('darktheme', 'false')
        }
    }
    
    // initlize darkmode button
    {
        const container = document.createElement('div');
        const btn = document.createElement('input');
        document.body.appendChild(container)
        container.appendChild(btn)
        btn.addEventListener('click', changeTheme)
        btn.type = 'button'
        btn.value = 'ğŸŒ“'
        btn.style.cssText = 'background-color: transparent !important; border: none; font-size: 25px; z-index: 999; position: fixed; right: 10%; bottom: 10%'
    }

	```

	ç¬¬ä¸€éƒ¨åˆ†æ˜¯æ›´æ¢ä¸»é¢˜çš„æ–¹æ³•ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯åŠ¨æ€åˆ›å»ºåˆ‡æ¢ä¸»é¢˜çš„æŒ‰é’®ã€‚